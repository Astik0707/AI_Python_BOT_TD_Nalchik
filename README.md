# AI Python Telegram Bot

Этот репозиторий содержит Telegram‑бота, который отвечает на аналитические запросы сотрудников компании. Бот использует модели OpenAI для обработки текстовых и голосовых сообщений, обращается к базе данных PostgreSQL и кэширует данные в Redis. Также предусмотрена отправка отчётов в формате Excel и сбор обратной связи для обучения модели.

## Основные возможности

- ответы на текстовые запросы с помощью OpenAI ChatGPT;
- расшифровка голосовых сообщений через OpenAI Whisper;
- получение данных из PostgreSQL и формирование отчётов;
- отправка отчётов в Excel по электронной почте;
- режим отладки и сбор обратной связи от пользователей.

## Установка и запуск

### Требования

- Python 3.10+
- Git

### Быстрый старт

```bash
git clone <repo_url>
cd AI_Python_BOT_TD_Nalchik
cp .env.example .env  # заполните токены и пароли
./setup.sh            # установка окружения и зависимостей
./run.sh              # запуск бота
```

Скрипт `setup.sh` создаёт виртуальное окружение, устанавливает зависимости, подготавливает файл `.env` и проверяет подключения. Для повторного запуска достаточно выполнить `./run.sh`.

## Зависимости

Основные библиотеки указаны в `requirements.txt`:

- `python-telegram-bot` — работа с Telegram API;
- `openai` — доступ к моделям OpenAI;
- `asyncpg` — асинхронное взаимодействие с PostgreSQL;
- `redis` — кэширование и хранение состояния;
- `pydantic`, `python-dotenv`, `pandas` и другие утилиты.

## Переменные окружения

Настройки берутся из файла `.env`. Ниже перечислены ключевые переменные и их назначение.

### Telegram
- `TELEGRAM_BOT_TOKEN` — токен вашего Telegram‑бота.
- `POLLING_INTERVAL_SECONDS` — интервал опроса API.
- `TELEGRAM_API_BASE_URL` — альтернативный URL Telegram API (опционально).

### OpenAI
- `OPENAI_API_KEY` — ключ доступа к OpenAI API.
- `OPENAI_MODEL_CHAT` — модель для обработки текстовых запросов.
- `OPENAI_MODEL_WHISPER` — модель для распознавания речи.
- `OPENAI_BASE_URL` — прокси или альтернативная точка доступа к API (опционально).

### PostgreSQL
- `PG_HOST`, `PG_PORT` — хост и порт базы данных.
- `PG_DB` — имя базы данных.
- `PG_USER`, `PG_PASSWORD` — учётные данные пользователя.
- `PG_SSLMODE` — режим SSL подключения.

### Redis
- `REDIS_HOST`, `REDIS_PORT` — адрес и порт Redis.
- `REDIS_DB` — номер базы данных.
- `REDIS_PASSWORD` — пароль, если требуется.

### SMTP / Email
- `SMTP_HOST`, `SMTP_PORT` — параметры SMTP‑сервера.
- `SMTP_USER`, `SMTP_PASSWORD` — учётные данные для отправки писем.
- `SMTP_STARTTLS` — использование STARTTLS.

### Прочие
- `CARDS_DIR` — путь к директории с карточками.
- `WORK_DIR` — рабочая директория для временных файлов.
- `LOG_LEVEL` — уровень логирования.

## Дополнительно

Для диагностики доступен скрипт `check_connections.py`, который проверяет корректность переменных окружения, подключение к PostgreSQL, OpenAI и Redis.

