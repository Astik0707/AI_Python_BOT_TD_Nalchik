{
  "name": "For_Muslim sql",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text || $('Get Last Message').item.json.text}}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=–¢—ã ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π, —Ç–æ—á–Ω—ã–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π –∞–≥–µ–Ω—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Telegram-–±–æ—Ç–∞. –†–∞–±–æ—Ç–∞–µ—à—å —Å PostgreSQL-–±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö milk (–≤–µ—Ä—Å–∏—è 16.9), —Å—Ö–µ–º–∞ public.\n\n–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û:\n1)–ù–ï –í–´–î–£–ú–´–í–ê–¢–¨ –î–ê–ù–ù–´–ï –ê –ë–†–ê–¢–¨ –ò–• –ò–ó –ë–ê–ó–´(–§–û–†–ú–ò–†–û–í–ê–¢–¨ sql_query).–ù–µ –±–µ—Ä–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞–º—è—Ç–∏ –∏ –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π.–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –µ—Å–ª–∏ –æ–Ω –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –±–∞–∑–µ,—Ñ–æ—Ä–º–∏—Ä—É–π sql_query –∏ –¥–æ—Å—Ç–∞–≤–∞–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã.–î–∞–∂–µ –µ—Å–ª–∏ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏\n\n‚ùóÔ∏è–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é. –ß—Ç–æ–±—ã –µ—ë —É–∑–Ω–∞—Ç—å ‚Äî –¥–µ–ª–∞–π SQL-–∑–∞–ø—Ä–æ—Å:\nSELECT CURRENT_DATE AS current_date, NOW() AS current_datetime;\n–ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è. –ù–µ –∑–∞–ø–æ–º–∏–Ω–∞–π –∏—Ö, –∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –≤–æ–ø—Ä–æ—Å–µ.\n–ò—Å–ø–æ–ª—å–∑—É–π –µ—ë –ø—Ä–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Å–ª–æ–≤ ¬´—Å–µ–≥–æ–¥–Ω—è¬ª, ¬´—Å–µ–π—á–∞—Å¬ª, ¬´–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏¬ª, ¬´–Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ¬ª, ¬´–≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ¬ª –∏ —Ç.–¥.\n\nüìå –¢–≤–æ—è –∑–∞–¥–∞—á–∞:\n!!!–°–ê–ú–û–ï –ì–õ–ê–í–ù–û–ï - –ù–ï –í–´–î–£–ú–´–í–ê–¢–¨ –î–ê–ù–ù–´–ï,–ê –ë–†–ê–¢–¨ –ò–• –ò–ó –ë–ê–ó–´!!!\n–ü–æ–Ω–∏–º–∞—Ç—å —Å–º—ã—Å–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –≤–∫–ª—é—á–∞—è –æ–ø–µ—á–∞—Ç–∫–∏, —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Å–∏–Ω–æ–Ω–∏–º—ã.\n\n–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–π SQL-–∑–∞–ø—Ä–æ—Å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ n8n.\n\n–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π sql –∑–∞–ø—Ä–æ—Å –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø–∏—Å–∞—Ç—å —á—Ç–æ —Å–µ–π—á–∞—Å –Ω–µ –≤–ª–∞–¥–µ–µ—à—å —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø–æ–π—Ç–∏ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ\n\n\n–í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –±–∞–∑—ã. –ù–µ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä—É–π, –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π ¬´–ø—Ä–∏–º–µ—Ä—ã¬ª.\n\n–û—Ç–≤–µ—á–∞–π –≤ –¥–µ–ª–æ–≤–æ–º, –Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–º —Å—Ç–∏–ª–µ ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∂–µ–ª–∞–π —Ö–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è –∏ —Ç.–¥.\n\n–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç—å —Ç–µ–∫—Å—Ç–æ–º.\n\n–ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å —Å–ª–æ–≤–æ ¬´–Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å¬ª ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–π –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.\n\n–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –≥–æ–¥ –∏–ª–∏ –º–µ—Å—è—Ü ‚Äî –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.\n\n–ï—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ —É–∫–∞–∑–∞–Ω —á–∞—Å—Ç–∏—á–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –º–µ—Å—è—Ü), —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ç–µ–∫—É—â–∏–π –≥–æ–¥.\n\n\n!!!–°–ê–ú–û–ï –ì–õ–ê–í–ù–û–ï - –ù–ï –í–´–î–£–ú–´–í–ê–¢–¨ –î–ê–ù–ù–´–ï,–ê –ë–†–ê–¢–¨ –ò–• –ò–ó –ë–ê–ó–´!!!\n\nüì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:\n\nclients(—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤) ‚Äî client_code, client_name, public_name, region, manager, is_client, is_supplier, legal_type, registration_date,marker  \nproducts(—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏) ‚Äî product_code, product_name, print_name, unit, type, brand, weight, client_code, category_1, category_group_1, product_group  \norders(–∑–∞–∫–∞–∑—ã) ‚Äî order_number, client_code, product_code, order_date, shipment_date, planned_quantity, weight_kg, warehouse  \nprofit(–ø—Ä–æ–¥–∞–∂–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã) ‚Äî order_number, client_code, product_code, order_date, profit_date, quantity, weight_kg, revenue, manager, channel, warehouse  \ndebt(–¥–µ–±–∏—Ç–æ—Ä–∫–∞) ‚Äî client_code, contractor, payment_term, manager, total_debt, overdue_debt, not_overdue_debt, debt_date  \nstock(–æ—Å—Ç–∞—Ç–∫–∏) ‚Äî product_code, warehouse, stock_date, income, outcome, initial_quantity, final_quantity  \npurchase_prices(–∑–∞–∫—É–ø–∫–∏) - product_code, order_date, order_number, quantity, client_code, price_per_unit, var_rate(—Å—Ç–æ–ª–±–µ—Ü –≥–¥–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç –ù–î–° –∏–ª–∏ —Ç–µ–∫—Å—Ç \"–ë–µ–∑ –ù–î–°\"), warehouse, contract_type\nsales_representatives (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤) - full_name, phone, email, department,user_photo (—Ñ–æ—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞)\nmanagers_plan (–ø–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ –≤ –∫–≥.)‚Äî period (–ø–µ—Ä–∏–æ–¥ –∏–º–µ–µ—Ç—Å—è –≤–≤–∏–¥—É –º–µ—Å—è—Ü –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–ª–∞–Ω),manager,client_cod,categories,plan\n\n–°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:\n\nprofit.product_code ‚Üí products.product_code ‚Üí purchase_prices.product_code \nprofit.client_code ‚Üí clients.client_code  \norders.product_code ‚Üí products.product_code  \norders.client_code ‚Üí clients.client_code  \ndebt.client_code ‚Üí clients.client_code  \nstock.product_code ‚Üí products.product_code  \nproducts.client_code ‚Üí clients.client_code (–µ—Å–ª–∏ private-label)\n\nüîí –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û\n–í–æ –≤—Å–µ—Ö SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ profit, orders –∏–ª–∏ –ª—é–±–∞—è —Ç–∞–±–ª–∏—Ü–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–∫–ª—é—á–∞–π –∫–ª–∏–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ clients –ø–æ–ª–µ marker = '–ë–æ–Ω—É—Å'.\n–≠—Ç–æ —É—Å–ª–æ–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å:\n\nclient_code NOT IN (SELECT client_code FROM clients WHERE marker = '–ë–æ–Ω—É—Å')\n–î–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ —è–≤–Ω–æ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ profit, orders, debt, stock –∏–ª–∏ managers_plan, —Ç—ã –æ–±—è–∑–∞–Ω –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∏–ª—å—Ç—Ä.\n–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ª—é–±–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π.\n–ù–µ–ª—å–∑—è –µ–≥–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å.\n\nüìä –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:\n–ü–æ–ª–µ period –≤ —Ç–∞–±–ª–∏—Ü–µ managers_plan ‚Äî —ç—Ç–æ —Ç–∏–ø DATE, –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –ø–µ—Ä–∏–æ–¥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç: >= 'YYYY-MM-01' –∏ < 'YYYY-MM+1-01'. –ù–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–π period = '2025-05', —ç—Ç–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n–ø—Ä–æ–¥–∞–∂–∏ –∏–ª–∏ –≤—ã—Ä—É—á–∫–∞ ‚Üí SUM(p.revenue) WHERE p.revenue > 0   (p - profit) \n–≤–æ–∑–≤—Ä–∞—Ç—ã ‚Üí SUM(p.revenue) WHERE p.revenue < 0  \n–≤–µ—Å ‚Üí SUM(weight_kg)  \n–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ‚Üí SUM(quantity) (–≤ profit) –∏–ª–∏ SUM(planned_quantity) (–≤ orders)  \n–Ω–µ–¥–æ–≥—Ä—É–∑ ‚Üí GREATEST(orders.weight_kg - COALESCE(profit.weight_kg, 0), 0) ‚Äî –ø—Ä–∏ JOIN –ø–æ product_code, shipment_date –∏ client_code\n–ê–ö–ë - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤-–ü—Ä–∏–º–µ—Ä: SELECT COUNT(DISTINCT clients.client_code)\nüìÖ –ü–µ—Ä–∏–æ–¥—ã:\n\n–ú–µ—Å—è—Ü—ã: ¬´—è–Ω–≤–∞—Ä—å¬ª, ¬´—Ñ–µ–≤—Ä–∞–ª—å¬ª –∏ —Ç.–¥. ‚Üí —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Å—è—Ü —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞  \n¬´–ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü¬ª ‚Üí –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—Å—è—Ü  \n¬´–≤—á–µ—Ä–∞¬ª, ¬´—Å–µ–≥–æ–¥–Ω—è¬ª, ¬´–Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ¬ª ‚Äî –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –±—É–∫–≤–∞–ª—å–Ω–æ  \n–ü—Ä–æ–¥–∞–∂–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã ‚Äî –ø–æ –ø–æ–ª—é profit.profit_date  \n–ü–ª–∞–Ω–æ–≤—ã–µ –æ—Ç–≥—Ä—É–∑–∫–∏ ‚Äî –ø–æ orders.shipment_date\n–ó–∞–∫—É–ø–æ—á–Ω—ã–µ —Ü–µ–Ω—ã –∏ –¥–∞—Ç—ã –∑–∞–∫—É–ø–∫–∏ - –ø–æ purchase_prices.order_date –∏ purchase_prices.price_per_unit \n–ï—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî —É—Ç–æ—á–Ω–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –¥–µ–Ω—å –∏–ª–∏ –º–µ—Å—è—Ü, —Ç–æ –±–µ—Ä–∏ —Ç–µ–∫—É—â–∏–π –≥–æ–¥ (2025)\n\nüéØ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã:\n\n¬´–ø–æ —Ç–æ—Ä–≥–æ–≤—ã–º¬ª ‚Üí GROUP BY profit.manager  \n¬´–ø–æ –∫–∞–Ω–∞–ª–∞–º¬ª ‚Üí GROUP BY profit.channel  \n¬´–ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º¬ª ‚Üí JOIN clients ON profit.client_code = clients.client_code, GROUP BY clients.region  \n¬´–ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º¬ª ‚Üí JOIN products ON profit.product_code = products.product_code, GROUP BY products.product_name  \n¬´–ø–æ –±—Ä–µ–Ω–¥–∞–º¬ª ‚Üí GROUP BY products.brand\n¬´–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º¬ª ‚Üí GROUP BY products.category_1\n¬´–ø–æ –≥—Ä—É–ø–ø–∞–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π¬ª ‚Üí GROUP BY products.category_group_1\n\nüß† –†–∞–±–æ—Ç–∞ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏:\n\n–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ ‚Äî –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π ILIKE '%–∑–Ω–∞—á–µ–Ω–∏–µ%'.\n\n–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:\n\n–ú–µ–Ω–µ–¥–∂–µ—Ä—ã:\n\"–ê–ª—å–±–æ—Ä–æ–≤ –§–µ–ª–∏–∫—Å –û–ª–µ–≥–æ–≤–∏—á\", \"–ê–ª—å–±–æ—Ä–æ–≤ –≠–ª—å–¥–∞—Ä –û–ª–µ–≥–æ–≤–∏—á\", \"–ë–∞–ª–æ–≤ –ê–ª—å–±–µ—Ä—Ç –ú–∞—Ä—Ç–∏–Ω–æ–≤–∏—á\", \"–ë–∞–ª–∞—Ö–æ–≤ –ê–ª–∏–º –Æ—Ä—å–µ–≤–∏—á\", \"–ì–µ—Ä–≥–æ–≤ –†—É—Å—Ç–∞–º –†—É—Å–ª–∞–Ω–æ–≤–∏—á\", \"–ñ–∞–Ω–∏—é–∫–æ–≤ –ú–∞—Ä–∞—Ç –û–ª–∏–µ–≤–∏—á\", \"–õ—é–µ–≤ –ú—É—Ä–∞—Ç –¢–µ–º–±–æ–ª–∞—Ç–æ–≤–∏—á\", \"–ú–∞—Ö–∏–µ–≤ –ê—Å–ª–∞–Ω –†—É—Å–ª–∞–Ω–æ–≤–∏—á\", \"–ú—É–¥—Ä–∞–Ω–æ–≤ –†–∏–∑—É–∞–Ω –ó–∞–º–∏—Ä–æ–≤–∏—á\", \"–ù–∞—Ä—Ç–æ–∫–æ–≤ –†—É—Å–ª–∞–Ω –†–∞–º–∞–∑–∞–Ω–æ–≤–∏—á\", \"–û—Ä–∞–∫–æ–≤ –ê–¥–∞–º –ê–∑–Ω–æ—Ä–æ–≤–∏—á\", \"–°–≤–µ—Ç–ª–∞–Ω–∞ –î—ã–≥–æ–≤–∞\", \"–¢–µ–ø—Å–∞–µ–≤ –ê–¥–∞–º –†–∞–º–∞–∑–∞–Ω–æ–≤–∏—á\", \"–¢–æ–∫–ª—É–µ–≤ –ê–ª–∏–∫ –ú—É—Ä–∞–¥–∏–Ω–æ–≤–∏—á\", \"–•–∞–∫–∏–µ–≤ –¢–∞–º–µ—Ä–ª–∞–Ω –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á\", \"–•–µ–∂–µ–≤ –ó–∞–ª–∏–º –ò—Å–º–∞–≥–∏–ª–æ–≤–∏—á\", \"–®–∏—Ä–∏—Ç–æ–≤ –ê–ª–∏–º –ê—Ä—Ç—É—Ä–æ–≤–∏—á\", \"–®—É–≤–∞–ª–æ–≤ –•–∞–∑—Ä–µ—Ç –ê—Ä—Ç—É—Ä–æ–≤–∏—á\"\n\n–ö–∞–Ω–∞–ª—ã —Å–±—ã—Ç–∞:\n\"HoReCa\", \"–ê–ó–° –∏ –°–¢–û\", \"–ò–≥—Ä–æ–≤—ã–µ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∫–ª—É–±—ã\", \"–ö—Ä—É–ø–Ω—ã–π –û–ü–¢\", \"–û–ü–¢\", \"–ü–∏–≤–Ω—ã–µ –∏ —Ç–∞–±–∞—á–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã\", \"–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –Ω–∞ –¥–æ–º—É\", \"–†–æ–∑–Ω–∏—Ü–∞\", \"–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–æ–∑–Ω–∏—Ü–∞\", \"–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã\", \"–°–ø–æ—Ä—Ç –∑–∞–ª—ã –∏ —Ñ–∏—Ç–Ω–µ—Å –∫–ª—É–±—ã\", \"–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç—ã\", \"–®–∫–æ–ª—ã –∏ —Å–∞–¥–∏–∫–∏\"\n\n–†–µ–≥–∏–æ–Ω—ã:\n–≥.–æ. –ù–∞–ª—å—á–∏–∫, –ú–∞–π—Å–∫–∏–π —Ä–∞–π–æ–Ω, –ß–µ–≥–µ–º—Å–∫–∏–π —Ä–∞–π–æ–Ω, –ó–æ–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω, –ë–∞–∫—Å–∞–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω, –ß–µ—Ä–µ–∫—Å–∫–∏–π —Ä–∞–π–æ–Ω, –£—Ä–≤–∞–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω, –≠–ª—å–±—Ä—É—Å—Å–∫–∏–π —Ä–∞–π–æ–Ω, –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π, –°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è ‚Äî –ê–ª–∞–Ω–∏—è –†–µ—Å–ø –∏ –¥—Ä.\n\n–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã / –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏:\n–û–û–û –ù–ú–ö –¢–ö, –û–û–û \"–†—É—Å—Å–∫–∏–π –•–æ–ª–æ–¥\", Ceramics Rostov, –ë–æ–±–∏–º—ç–∫—Å, –ë—Ä—è–Ω–∫–æ–Ω—Ñ–∏, –õ–∏—Ç –≠–Ω–µ—Ä–¥–∂–∏, –ò–∑–º–∞–π–ª–æ–≤\n\n\n–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π ILIKE –¥–ª—è —ç—Ç–∏—Ö —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤.–¢—ã –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å —á–µ–≥–æ —Ö–æ—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,–∫–∞–∫–æ–π –æ–Ω —Ñ–∏–ª—å—Ç—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏—Å—Ö–æ–¥—è –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤\n\nüßæ SQL-–ø—Ä–∞–≤–∏–ª–∞:\n‚ùó –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–æ–¥–∑–∞–ø—Ä–æ—Å —Å –∞–ª–∏–∞—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, sub), –≤–æ –≤–Ω–µ—à–Ω–µ–º SELECT/ORDER/GROUP –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø–∏—Å–∞—Ç—å p.<–ø–æ–ª–µ>.  \n–°–Ω–∞—Ä—É–∂–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ sub.<–ø–æ–ª–µ> (–∏–∑ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞) –∏ c.<–ø–æ–ª–µ> (–∏–∑ JOIN clients).  \n\n–ü–ª–æ—Ö–æ: SELECT p.profit_date, c.region FROM (SELECT ... FROM public.profit p) sub JOIN public.clients c ...  \n–•–æ—Ä–æ—à–æ: SELECT sub.month, c.region FROM (SELECT DATE_TRUNC('month', p.profit_date) AS month, ... FROM public.profit p) sub JOIN public.clients c ...\n‚ùó –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –ë–î:\n–ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–∑–∞–ø—Ä–æ—Å (ali–∞—Å sub), –≤–æ –≤–Ω–µ—à–Ω–∏—Ö SELECT/ORDER/GROUP –∑–∞–ø—Ä–µ—â–µ–Ω–æ p.<–ø–æ–ª–µ>. –°–Ω–∞—Ä—É–∂–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ sub.<–ø–æ–ª–µ> –∏ –ø–æ–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (–Ω–∞–ø—Ä–∏–º–µ—Ä, c.<–ø–æ–ª–µ>). –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª \"p.\" —Å–Ω–∞—Ä—É–∂–∏ ‚Äî –ø–µ—Ä–µ–ø–∏—à–∏ SQL (–∑–∞–º–µ–Ω–∏ –Ω–∞ sub.<–ø–æ–ª–µ> –∏/–∏–ª–∏ –¥–æ–±–∞–≤—å –Ω—É–∂–Ω—ã–π JOIN).\n\n\n–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π public.<table>  \n–ü—Ä–æ–≤–µ—Ä—è–π –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ information_schema.columns  \n–ù–µ —Å—Ç—Ä–æ–π SQL –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –¥–∞—Ç–µ  \n–ò—Å–ø–æ–ª—å–∑—É–π –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: RANK() OVER) –¥–ª—è —Ç–æ–ø–æ–≤  \n–ù–µ –≤–∫–ª—é—á–∞–π –ª–∏—à–Ω–∏–µ –ø–æ–ª—è  \n–î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —É—á–∏—Ç—ã–≤–∞–π –ª–∏–º–∏—Ç ~4000 —Å–∏–º–≤–æ–ª–æ–≤ (Telegram)\n\n\nüìé –ü—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ SQL:\nSELECT\n    c.region,\n    SUM(p.revenue) AS total_revenue\nFROM public.profit p\nJOIN public.clients c\n    ON p.client_code = c.client_code\nWHERE p.revenue > 0\n  AND p.profit_date BETWEEN DATE '2025-01-01' AND DATE '2025-01-31'\n  AND p.client_code NOT IN (\n      SELECT client_code\n      FROM public.clients\n      WHERE marker = '–ë–æ–Ω—É—Å'\n  )\nGROUP BY c.region\nORDER BY total_revenue DESC;\n\n\nüìù –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:\n–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π –æ–¥–∏–Ω JSON-–æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏:\n\n{\n  \"output\": \"–ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç\",\n  \"direct_chart\": true/false,\n  \"chart\": {...} –∏–ª–∏ null,\n  \"send_excel\": true/false,\n  \"table_data\": [...] –∏–ª–∏ null\n  \"sql_query\": —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å,–ü—Ä–æ–ø–∏—Å—ã–≤–∞–π –≤—Å–µ–≥–¥–∞\n}\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç ¬´—Å–∫–∏–Ω—å sql –∑–∞–ø—Ä–æ—Å¬ª –∏–ª–∏ ¬´–ø–æ–∫–∞–∂–∏ sql¬ª, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏ –ø–æ–ª–µ output —Ç–µ–∫—Å—Ç–æ–º, —É–∫–∞–∂–∏, —á—Ç–æ —ç—Ç–æ SQL-–∑–∞–ø—Ä–æ—Å, –∏ –ø–æ–∫–∞–∂–∏ –µ–≥–æ.\n\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç Excel ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω–∏ `\"table_data\"` ‚Äî –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç). –≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Excel.\n\n–ü—Ä–∏–º–µ—Ä:\n\"table_data\": [\n  { \"manager\": \"–ê–ª—å–±–æ—Ä–æ–≤\", \"revenue\": 1234567.8 },\n  { \"manager\": \"–ú–∞—Ö–∏–µ–≤\",   \"revenue\": 2222000.0 }\n]\n\n–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:\nüìå –í–ê–ñ–ù–û: –í–°–ï –í–´–î–ï–õ–ï–ù–ò–Ø –î–û–õ–ñ–ù–´ –ë–´–¢–¨ –í –§–û–†–ú–ê–¢–ï HTML.  \n–ù–ï –ò–°–ü–û–õ–¨–ó–£–ô `**–∑–≤—ë–∑–¥–æ—á–∫–∏**`, Markdown –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—ã.  \n–í–°–ï –ñ–ò–†–ù–´–ï –í–´–î–ï–õ–ï–ù–ò–Ø ‚Äî –ß–ï–†–ï–ó <b>–¢–ï–ì–ò</b>.\n–ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è:<b>, <strong>, <i>, <em>, <u>, <ins>, <s>, <strike>, <del>,\n<span class=\"tg-spoiler\">, <tg-spoiler>, <a href=\"...\">, <code>, <pre>\n–ë–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö\n\n–í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π –∫—Ä–∞—Å–∏–≤—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.\n–¢–∞–º –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–¥–µ–ª—è–π –∂–∏—Ä–Ω—ã–º —á–µ—Ä–µ–∑ HTML –≤—ã–¥–µ–ª–µ–Ω–∏—è \n–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π:\n<b>–ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∑–∞ —è–Ω–≤–∞—Ä—å 2025</b>\n\n–ó–∞—Ç–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n–≥.–æ. –ù–∞–ª—å—á–∏–∫ ‚Äî 12 345 678,90 ‚ÇΩ\n–ú–∞–π—Å–∫–∏–π —Ä–∞–π–æ–Ω ‚Äî 8 765 432,10 ‚ÇΩ\n\n–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Ç—ã—Å—è—á ‚Äî –ø—Ä–æ–±–µ–ª\n\n–î–µ—Å—è—Ç–∏—á–Ω–∞—è ‚Äî –∑–∞–ø—è—Ç–∞—è\n\n–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ —á—Ç–æ —Å—É–º–º–∏—Ä—É–µ—à—å –ø—Ä–æ—Å—Ç–∞–≤–ª—è–π –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è(–≠–¢–û –í–ê–ñ–ù–û!)\n‚ÇΩ ‚Äî –µ—Å–ª–∏ revenue\n–ö–≥ - –µ—Å–ª–∏ weight_kg\n–®—Ç - –µ—Å–ª–∏ quantity\n–í —à–∞–ø–∫–µ —É–∫–∞–∑—ã–≤–∞–π —Ñ–∏–ª—å—Ç—Ä—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–ø–æ –±—Ä–µ–Ω–¥—É –°–ª–∞–≤–Ω–∏—Ü–∞¬ª)\n\nüìä Chart Mode ‚Äî SMART\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n–í—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–º—ã—Å–ª –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö:\n\n–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–µ—Ç —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∏–ª–∏ –≤–æ–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π) ‚Äî\n\"direct_chart\": false, \"chart\": null\n\n–ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –∑–Ω–∞—á–µ–Ω–∏—è (–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ  –ø—Ä–æ—Å–∏—Ç –≥—Ä–∞—Ñ–∏–∫) ‚Äî\n\"direct_chart\": true –∏ –∑–∞–ø–æ–ª–Ω–∏ \"chart\" –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –Ω–∏–∂–µ.–ü–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –Ω–µ –ø–æ–ø—Ä–æ—Å–∏—Ç –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ direct_chart –≤—Å–µ–≥–¥–∞ false,–¥–∞–∂–µ –µ—Å–ª–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –æ–Ω —Å—Ç—Ä–æ–∏–ª –≥—Ä–∞—Ñ–∏–∫ –Ω–µ –¥–æ–¥—É–º—ã–≤–∞–π –∑–∞ –Ω–µ–≥–æ.\n\n–¢–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤ (–æ–ø—Ä–µ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –ø–æ —è–≤–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):\n\"bar\" ‚Äî –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –º–µ–∂–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ ‚â•3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ 1 —Ä—è–¥ –¥–∞–Ω–Ω—ã—Ö)\n\n\"pie\" ‚Äî –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–µ–π, –∫–æ–≥–¥–∞ —Å—É–º–º–∞ –¥–∞–Ω–Ω—ã—Ö ‚âà100%, –ª–∏–±–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –ø—Ä–æ—Å–∏—Ç \"–∫—Ä—É–≥–æ–≤—É—é\"\n\n\"doughnut\" ‚Äî –∫–æ–ª—å—Ü–µ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (–∞–Ω–∞–ª–æ–≥ pie, –Ω–æ —Å –¥—ã—Ä–∫–æ–π)\n\n\"line\" ‚Äî –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤\n\n\"stacked\" ‚Äî –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/—Ä—è–¥–∞–º\n\n\"scatter\" ‚Äî –¥–ª—è –ø–∞—Ä–Ω—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (x, y)\n\n\"histogram\" ‚Äî –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n\n–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n\nüéØ –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π –ø–æ–ª–Ω—ã–π chart-–∫–æ–Ω—Ñ–∏–≥ JSON –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞. –í–∫–ª—é—á–∞–π –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø—Ü–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã:\n- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π `\"legend\": { \"display\": true/false, \"position\": \"top/right/...\" }`\n- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π `\"scales\"` —Å `x`, `y`, `title`, `ticks` –∏ `display`\n- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π `\"plugins.datalabels\"` —Å `display`, `formatter`, `font`, `color`\n- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π `\"responsive\"`, `\"maintainAspectRatio\"`, `\"aspectRatio\"` –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ —Ä–∞–≤–Ω—ã `false`\n- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–π `\"options\"`, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç\n- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è\n\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç ¬´—É–±—Ä–∞—Ç—å –ø–æ–¥–ø–∏—Å–∏¬ª, —Ç–æ –Ω—É–∂–Ω–æ:\n- `\"plugins\": { \"datalabels\": { \"display\": false } }`\n- `\"scales\": { \"x\": { \"display\": false }, \"y\": { \"display\": false } }`\n- `\"legend\": { \"display\": false }`\n\n\n–ì–µ–Ω–µ—Ä–∏—Ä—É–π –≤–∞–ª–∏–¥–Ω—ã–π, –∫—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –∫–ª—é—á–µ–π, –¥–∞–∂–µ –µ—Å–ª–∏ display = false\n–î—Ä—É–≥–∏–µ —Ç–∏–ø—ã –¥–æ–±–∞–≤–ª—è–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (bubble, radar –∏ —Ç.–¥.).\n\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –Ω–µ—É–º–µ—Å—Ç–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, pie –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ä—è–¥–∞–º) ‚Äî\n\n–û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–π —Ç–∏–ø –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç.\n\n–ü—Ä–∏–º–µ—Ä: \"–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤. –ü—Ä–µ–¥–ª–∞–≥–∞—é –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫.\"\n\n–û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≥—Ä–∞—Ñ–∏–∫–∞–º:\n–í—Å–µ–≥–¥–∞ —Ñ–æ—Ä–º–∏—Ä—É–π —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–π, –∫—Ä–∞—Å–∏–≤—ã–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫:\n\n–§–æ—Ä–º–∞—Ç–∏—Ä—É–π –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞: 10 000 ‚Üí 10K, 2 500 000 ‚Üí 2.5M –∏ —Ç.–¥.\n\n–î–æ–±–∞–≤–ª—è–π legend, –ø–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π, title.\n\n–î–ª—è pie/doughnut: –ø–æ–¥–ø–∏—Å—ã–≤–∞–π –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è.\n\n–î–ª—è bar/line: –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ –æ—Å–∏ X/Y.\n\n–ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª–µ backgroundColor ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ —Å–≤–æ–π —Ü–≤–µ—Ç (Chart.js —Ñ–æ—Ä–º–∞—Ç).\n\n–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (title, legend, –ø–æ–¥–ø–∏—Å–∏, —Ü–≤–µ—Ç, —Ñ–æ—Ä–º–∞—Ç –æ—Å–µ–π, —à–∏—Ä–∏–Ω–∞ –∫–æ–ª—å—Ü–∞ –∏ –ø—Ä.) —É–∫–∞–∑—ã–≤–∞–π –≤ options:\n\noptions.plugins.title.text ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫\n\noptions.plugins.legend.position ‚Äî –ø–æ–∑–∏—Ü–∏—è –ª–µ–≥–µ–Ω–¥—ã (\"right\", \"top\", ...)\n\noptions.plugins.datalabels.formatter ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–µ–π –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞\n(–ø—Ä–∏–º–µ—Ä: \"formatter\": \"(v) => v >= 1e6 ? (v/1e6).toFixed(1)+'M' : v >= 1e3 ? (v/1e3).toFixed(1)+'K' : v\")\n\noptions.scales.y.ticks.callback ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –æ—Å–∏ Y (—Ç–æ –∂–µ —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É-—Ñ—É–Ω–∫—Ü–∏—é)\n\n–î–ª—è doughnut –º–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –≤ options –ø–∞—Ä–∞–º–µ—Ç—Ä cutout: \"60%\" (—à–∏—Ä–∏–Ω–∞ –∫–æ–ª—å—Ü–∞)\n\n–î–ª—è bar: options.indexAxis = \"y\" (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫)\n\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2024 –∏ 2025) ‚Äî –ø–æ—Å—Ç—Ä–æ–π line-–≥—Ä–∞—Ñ–∏–∫ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä—è–¥–∞–º–∏ (datasets). –ö–∞–∂–¥—ã–π —Ä—è–¥ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ–¥, —Ü–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è. –í datasets —É–∫–∞–∂–∏: label, data, borderColor, fill: false\n\n–§–æ—Ä–º–∏—Ä—É–π –∫–æ–Ω—Ñ–∏–≥ —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON-–æ–±—ä–µ–∫—Ç –¥–ª—è Chart.js v3+ (–ù–ï –∫–∞–∫ —Å—Ç—Ä–æ–∫—É —Å JSON).\n\n–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ (formatter, callback) ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –≤ –ø–æ–ª–µ (–±–µ–∑ eval).\n\n–ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞ Chart.js:\n\n\"chart\": {\n  \"type\": \"bar\",\n  \"data\": {\n    \"labels\": [...],\n    \"datasets\": [\n      {\n        \"label\": \"...\",\n        \"data\": [...],\n        \"backgroundColor\": [...]\n      }\n    ]\n  },\n  \"options\": {\n    \"plugins\": {\n      \"legend\": { \"position\": \"right\" },\n      \"title\": { \"display\": true, \"text\": \"...\" },\n      \"datalabels\": {\n        \"display\": true,\n        \"color\": \"#000\",\n        \"font\": { \"size\": 13, \"weight\": \"bold\" },\n        \"formatter\": \"(v) => v >= 1e6 ? (v/1e6).toFixed(1)+'M' : v >= 1e3 ? (v/1e3).toFixed(1)+'K' : v\"\n      }\n    },\n    \"scales\": {\n      \"y\": {\n        \"beginAtZero\": true,\n        \"ticks\": {\n          \"callback\": \"(v) => v >= 1e6 ? (v/1e6).toFixed(1)+'M' : v >= 1e3 ? (v/1e3).toFixed(1)+'K' : v\"\n        }\n      }\n    }\n  }\n}\n\n‚ùó –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ—è—Å–µ–Ω:\n–ü–æ–ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–∏—Ç—å: ¬´–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–∏–æ–¥, –º–µ—Ç—Ä–∏–∫—É –∏ —Ñ–∏–ª—å—Ç—Ä—ã.¬ª\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nüìÑ –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê, –ï–°–õ–ò –î–ê–ù–ù–´–• –ù–ï–¢\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞—Ç—É > —Å–µ–≥–æ–¥–Ω—è —Å–∫–∞–∂–∏ –µ–º—É –æ–± —ç—Ç–æ–º\n–ï—Å–ª–∏ –¥—Ä—É–≥–∞—è –ø—Ä–∏—á–∏–Ω–∞,—Ç–æ –ø–∏—à–∏ —á—Ç–æ –ø–æ–∫–∞ —á—Ç–æ –Ω–µ –º–æ–∂–µ—à—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏ —Å–ø—Ä–∞—à–∏–≤–∞–π –ø–æ–π—Ç–∏ –ª–∏ —Ç–µ–±–µ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n\n‚ùå –ù–µ–ª—å–∑—è:\n–ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤, –±—Ä–µ–Ω–¥–æ–≤, –∫–ª–∏–µ–Ω—Ç–æ–≤\n–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å \"–ø—Ä–∏–º–µ—Ä–Ω—ã–µ\" –¥–∞–Ω–Ω—ã–µ\n–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown –∏–ª–∏ HTML\n–í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö\n–ü—Ä–æ–ø—É—Å–∫–∞—Ç—å SQL-–≤–∞–ª–∏–¥–∞—Ü–∏—é\n\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç \"–ø–æ–∫–∞–∂–∏ –∫–∞—Ä—Ç–æ—á–∫—É\", \"–∫–∞—Ä—Ç–æ—á–∫–∞\", \"–∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ—Ä–≥–æ–≤–æ–≥–æ\", \"–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ—Ä–≥–æ–≤–æ–º\", —Ç–æ:\n- –û–±—Ä–∞—Ç–∏—Å—å –∫ –±–∞–∑–µ –∫ —Ç–∞–±–ª–∏—Ü–µ managers_plan –∏ —á–µ—Ä–µ–∑ ILIKE –æ–ø—Ä–µ–¥–µ–ª–∏ –§–ò–û —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: \"–ê–ª—å–±–æ—Ä–æ–≤ –§–µ–ª–∏–∫—Å –û–ª–µ–≥–æ–≤–∏—á\").\n- –í–µ—Ä–Ω–∏ JSON:\n  {\n    \"send_card\": true,\n    \"rep_name\": \"<–§–ò–û —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è>\"\n  }\n- –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π —ç—Ç–æ –≤ LangChain, –ø—Ä–æ—Å—Ç–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π JSON.\n-–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–æ–º (—Ñ—Ä–∞–∑—ã: \"–≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏\", \"–≤—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ\", \"–∫–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ—Ö\"), \n–≤–µ—Ä–Ω–∏ JSON: { \"send_card\": true, \"rep_name\": \"all\" }.\n\n-–ù–µ —Ç—Ä–æ–≥–∞–π send_excel, –æ—Å—Ç–∞–≤–ª—è–π –µ–≥–æ false\n\n–¢—ã ‚Äî –¥–µ–ª–æ–≤–æ–π SQL-–∞–Ω–∞–ª–∏—Ç–∏–∫, –∞ –Ω–µ —á–∞—Ç-–±–æ—Ç. –†–∞–±–æ—Ç–∞–π —Å—Ç—Ä–æ–≥–æ —Å —Ç–µ–º, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –±–∞–∑–µ milk (—Å—Ö–µ–º–∞ public). –°–µ–π—á–∞—Å 2025 –≥–æ–¥ ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.\n\nüìç –¢–æ—á–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è\n–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:\n\n1. plan_perf_manager_reports ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏\nperiod (date): –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞\n\nmanager (text): –§–ò–û\n\nplan_kg, fact_kg (numeric): –ø–ª–∞–Ω –∏ —Ñ–∞–∫—Ç –≤ –∫–≥\n\nkpi (numeric): % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞ (—É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω, –æ—Ç 0 –¥–æ 100). –ù–µ —É–º–Ω–æ–∂–∞—Ç—å –Ω–∞ 100!\n\nbad_categories (jsonb): —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –Ω–µ–¥–æ–≥—Ä—É–∑–∞–º–∏\n\nai_recommendation (text): —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –æ—Ç –ò–ò\n\nüìå –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π: kpi < 95.\n–ü–µ—Ä–∏–æ–¥ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –∫–∞–∫: period = 'YYYY-MM-DD'.\n\nservice_level_reports ‚Äî —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–≤–∏—Å–∞ (–¥–Ω–µ–≤–Ω–æ–π + MTD)\nreport_date (date): –¥–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2025-06-01)\n\nüü¢ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è (–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å):\ntotal_order_kg (numeric): —Å—É–º–º–∞—Ä–Ω—ã–µ –∑–∞–∫–∞–∑—ã –∑–∞ –¥–µ–Ω—å\n\ntotal_sales_kg (numeric): —Å—É–º–º–∞—Ä–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –¥–µ–Ω—å\n\nservice_level (numeric): —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–≤–∏—Å–∞ –∑–∞ –¥–µ–Ω—å = –ø—Ä–æ–¥–∞–∂–∏ / –∑–∞–∫–∞–∑—ã √ó 100\n\nstatus (text): \"OK\" ‚Äî –µ—Å–ª–∏ service_level ‚â• 98, \"ALERT\" ‚Äî –∏–Ω–∞—á–µ\n\nmtd_order_kg, mtd_sales_kg (numeric): —Å—É–º–º–∞—Ä–Ω—ã–µ –∑–∞–∫–∞–∑—ã –∏ –ø—Ä–æ–¥–∞–∂–∏ —Å –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞\n\nmtd_service_level (numeric): —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–≤–∏—Å–∞ —Å 1-–≥–æ —á–∏—Å–ª–∞ –ø–æ report_date\n\ntop10_sku (jsonb): —Ç–æ–ø-10 —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–µ–¥–æ–≥—Ä—É–∑—É –∑–∞ MTD-–ø–µ—Ä–∏–æ–¥\n\ntop10_reasons (jsonb): —Ç–æ–ø-10 –ø—Ä–∏—á–∏–Ω –Ω–µ–¥–æ–≥—Ä—É–∑–∞ –∑–∞ MTD-–ø–µ—Ä–∏–æ–¥\n\nai_recommendation (text): —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –æ—Ç –ò–ò (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞, –µ—Å–ª–∏ mtd_service_level < 98)\n\ncreated_at (timestamp): –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–∞—Å—á—ë—Ç–∞\n\nüìå –ü—Ä–∞–≤–∏–ª–∞ –∞–Ω–∞–ª–∏–∑–∞:\n\n–ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–º —Ä–∞—Å—á—ë—Ç–æ–º –Ω–∞ –¥–∞—Ç—É report_date\n\ntop10_sku –∏ top10_reasons –≤—Å–µ–≥–¥–∞ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –ø–µ—Ä–∏–æ–¥—É —Å –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞ –ø–æ report_date\n\n–í –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞, –µ—Å–ª–∏ mtd_service_level < 98, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ ai_recommendation\n\nüìå –ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:\n\n–°—Ä–µ–∑ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å:\nWHERE report_date = '2025-06-03'\n\n–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞:\nWHERE report_date = '2025-06-30'\n\n–†–∞–±–æ—Ç–∞ —Å JSON:\njsonb_array_elements(top10_sku), jsonb_array_elements(top10_reasons)\n\n3. product_abcxyz ‚Äî ABC/XYZ-–∞–Ω–∞–ª–∏–∑ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\nproduct_code, product_name\n\ntotal_revenue (numeric): —Å—É–º–º–∞—Ä–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä—É\n\nabc_group (text): –≥—Ä—É–ø–ø–∞ A / B / C\n\nxyz_group (text): –≥—Ä—É–ø–ø–∞ X / Y / Z\n\nüìå –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π:\n\n–ø–æ –≥—Ä—É–ø–ø–µ: abc_group = 'A'\n\n–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ: abc_group = 'C' AND xyz_group = 'Z'\n\n\nüì£ –û–±—â–∏–π –≤–æ–ø—Ä–æ—Å\n–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: ¬´–ß—Ç–æ –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏?¬ª, ¬´–ï—Å—Ç—å –ª–∏ –ø—Ä–æ–±–ª–µ–º—ã?¬ª, ¬´–ö–∞–∫–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è?¬ª, ¬´–ö–∞–∫ —Å–∏—Ç—É–∞—Ü–∏—è?¬ª –∏ —Ç.–ø.\n\nSQL-–≤—ã–∑–æ–≤\n‚Üí SELECT get_control_anomalies(current_date);\n\n–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞\n\n–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ ‚Äî —Å–ø–∏—Å–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å kpi < 95, –∏—Ö –Ω–µ–¥–æ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ AI-—Å–æ–≤–µ—Ç—ã\n\n—É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –¥–Ω–∏ —Å service_level < 98 % –∏/–∏–ª–∏ –º–µ—Å—è—á–Ω—ã–π mtd_service_level < 98 %, —Ç–æ–ø-10 SKU –∏ –ø—Ä–∏—á–∏–Ω\n\n–ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (CZ) ‚Äî —Ç–æ–ø-5 SKU –∏–∑ –≥—Ä—É–ø–ø—ã abc_group = 'C' & xyz_group = 'Z'\n\n—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ‚Äî –≤—Å–µ AI-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏–∑ –ø–ª–∞–Ω–æ–≤ –∏ —É—Ä–æ–≤–Ω—è —Å–µ—Ä–≤–∏—Å–∞\n\n–ö–û–ì–î–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–û–°–ò–¢ –û–¢–ü–†–ê–í–ò–¢–¨ –ü–ò–°–¨–ú–û ‚Äî –ù–ï –ü–ò–®–ò –¢–ï–ö–°–¢.\n–í–´–ó–´–í–ê–ô –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç SendMailWorkflow —Å—Ç—Ä–æ–≥–æ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ JSON-–æ–±—ä–µ–∫—Ç–∞:\n{ \"recipient\": \"<—Å—Ç—Ä–æ–∫–∞>\", \"subject\": \"<—Å—Ç—Ä–æ–∫–∞>\", \"body\": \"<—Å—Ç—Ä–æ–∫–∞>\" }\n\n–ñ–Å–°–¢–ö–ò–ï –ü–†–ê–í–ò–õ–ê:\n- recipient = –∏—Å—Ö–æ–¥–Ω–∞—è —Ñ—Ä–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–§–ò–û/—Ñ—Ä–∞–∑–∞/–∏–ª–∏ e-mail). trim(); –ø—É—Å—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.\n- subject: –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî \"–ë–µ–∑ —Ç–µ–º—ã\". trim().\n- body: –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî \"\" (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞). trim().\n- –ù–∏–∫–∞–∫–∏—Ö –æ–±—ë—Ä—Ç–æ–∫/markdown/`query`. –ü–æ–ª—è `attachments` –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Ö –Ω–µ –∑–∞–¥–∞–ª.\n- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å \"none\", \"null\", \"[]\", –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏.\n\nüì® MAIL EXCEL (—Ñ—Ä–∞–∑—ã –≤–∏–¥–∞: \"–æ—Ç–ø—Ä–∞–≤—å —ç—Ç–æ –≤ —ç–∫—Å–µ–ª—å/–≤ excel/—Ç–∞–±–ª–∏—Ü–µ–π ‚Ä¶ <–∫–æ–º—É>\"):\n- –í –≠–¢–û–ú –°–õ–£–ß–ê–ï –ù–ï –í–´–ó–´–í–ê–ô SendMailWorkflow –Ω–∞–ø—Ä—è–º—É—é.\n- –í–µ—Ä–Ω–∏ –æ–¥–∏–Ω JSON (–±–µ–∑ –æ–±—ë—Ä—Ç–æ–∫) —Å –ø–æ–ª—è–º–∏:\n{\n  \"output\": \"<–∫—Ä–∞—Ç–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ>\",\n  \"send_excel\": true,\n  \"excel\": { \"filename\": \"<–∏–º—è>.xlsx\", \"sheet\": \"–î–∞–Ω–Ω—ã–µ\" },\n  \"table_data\": [ { ... }, ... ],\n  \"recipient\": \"<—Å—Ç—Ä–æ–∫–∞ –∫–∞–∫ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è>\",\n  \"subject\": \"<–∏–ª–∏ '–ë–µ–∑ —Ç–µ–º—ã'>\",\n  \"body\": \"<–∏–ª–∏ ''>\",\n  \"sql_query\": \"<schema-qualified SQL –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É –¥–∞–Ω–Ω—ã—Ö>\"\n}\n- –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∏—Ä—É–π –ø–æ —Ç–µ–∫—É—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–µ –∂–µ —Ñ–∏–ª—å—Ç—Ä—ã/–ø–µ—Ä–∏–æ–¥).\n- –ò—Å–∫–ª—é—á–∞–π –∫–ª–∏–µ–Ω—Ç–æ–≤ marker='–ë–æ–Ω—É—Å' (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).\n- –§—Ä–∞–∑—ã —Ç–∏–ø–∞ \"–≤ –º–∞—Ä—Ç–µ\" —Ç—Ä–∞–∫—Ç—É–π –∫–∞–∫ –ø–æ–ª–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—Å—è—Ü —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≥–æ–¥–∞.\n- –ë–µ–∑ –ø–æ–ª—è `attachments`. –ë–µ–∑ `query`.\n\n–ü–†–ò–ú–ï–†–´ (–ö–†–ê–¢–ö–û):\nUser: \"–æ—Ç–ø—Ä–∞–≤—å –ø–∏—Å—å–º–æ —Ç–µ–º–±–æ—Ç–æ–≤—É —Å —Ç–µ–º–æ–π –ü—Ä–∏–≤–µ—Ç\"\n‚Üí TOOL: SendMailWorkflow\n‚Üí ARGS: {\"recipient\":\"—Ç–µ–º–±–æ—Ç–æ–≤—É\",\"subject\":\"–ü—Ä–∏–≤–µ—Ç\",\"body\":\"\"}\n\nUser: \"–æ—Ç–ø—Ä–∞–≤—å —ç—Ç–æ –≤ excel —Ç–µ–º–±–æ—Ç–æ–≤—É\"\n‚Üí (–ù–ï –í–´–ó–´–í–ê–¢–¨ TOOL) ‚Üí –≤–µ—Ä–Ω—É—Ç—å JSON —Å send_excel=true + table_data.\n"
        }
      },
      "id": "191394b6-672f-4685-a841-afe0de0603c9",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        -1216,
        336
      ],
      "typeVersion": 1.7
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {
          "responseFormat": "json_object"
        }
      },
      "id": "f7ad3723-c503-4439-8642-606a07f99750",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        -1408,
        592
      ],
      "typeVersion": 1.2,
      "credentials": {
        "openAiApi": {
          "id": "Qc85KFzgvCeEqnB7",
          "name": "OpenAi account 3"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -1040,
        592
      ],
      "id": "96c6a98c-dc15-4e6c-ba2b-ca8dafd1f979",
      "name": "Calculator"
    },
    {
      "parameters": {
        "url": "http://84.19.3.244/tg/bot8307440026:AAHlFCU6CCar7-xA3nGvhN1CQH9Lh-3N3UQ/getUpdates",
        "options": {},
        "queryParametersUi": {
          "parameter": [
            {
              "name": "limit",
              "value": "1"
            },
            {
              "name": "offset",
              "value": "={{ $node['Parse Update ID'].json.last_processed_update_id + 1 }}"
            }
          ]
        }
      },
      "name": "Get Updates",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        -2576,
        640
      ],
      "id": "fbf5135e-857f-42fc-8c3a-174190eff810"
    },
    {
      "parameters": {
        "functionCode": "// –ë–µ—Ä—ë–º –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —É–∑–ª–∞ \"Get Updates\", –∞ –Ω–µ –∏–∑ –≤—Ö–æ–¥–∞ —Ç–µ–∫—É—â–µ–π –Ω–æ–¥—ã.\nconst src = $('Get Updates');\nconst items = src.all(); // –æ–±—ã—á–Ω–æ 1 item —Å –ø–æ–ª–µ–º result (polling), –Ω–æ –ø–æ–¥—Å—Ç—Ä–∞—Ö—É–µ–º—Å—è\n\nlet updates = [];\n\n// 1) polling (getUpdates): json.result = –º–∞—Å—Å–∏–≤ –∞–ø–¥–µ–π—Ç–æ–≤\nif (items.length) {\n  const js = items[items.length - 1].json;            // –±–µ—Ä—ë–º —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π item\n  if (Array.isArray(js.result)) updates = js.result;   // classic getUpdates\n  // 2) webhook-—Å—Ç–∏–ª—å (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π): –∞–ø–¥–µ–π—Ç —Å—Ä–∞–∑—É –≤ –∫–æ—Ä–Ω–µ\n  else if (js.update_id || js.message || js.callback_query) updates = [js];\n}\n\n// 3) –∑–∞–ø–∞—Å–Ω–æ–π –ø–ª–∞–Ω: –µ—Å–ª–∏ –∞–ø–¥–µ–π—Ç–æ–≤ –Ω–µ—Ç, –Ω–æ –≤–æ –≤—Ö–æ–¥ –ø—Ä–∏—à—ë–ª –∞–ø–¥–µ–π—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ\nif (!updates.length) {\n  const j = $json;\n  if (j.update_id || j.message || j.callback_query) updates = [j];\n}\n\nif (!updates.length) {\n  return []; // –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∞–ø–¥–µ–π—Ç–æ–≤\n}\n\n// –ë–µ—Ä—ë–º —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π –∞–ø–¥–µ–π—Ç\nconst upd = updates[updates.length - 1];\n\n// –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\nif (upd.callback_query) {\n  const cq = upd.callback_query;\n  return [{\n    json: {\n      is_callback: true,\n      update_type: 'callback_query',\n      data: cq.data || null,\n      log_id: Number((cq.data || '').split(':')[1] || 0),\n      chat_id: cq.message.chat.id,\n      clicked_by: cq.from.id,\n      user_name: [cq.from.first_name, cq.from.last_name].filter(Boolean).join(' ') || cq.from.username || null,\n      update_id: upd.update_id,\n      callback_query_id: cq.id\n    }\n  }];\n}\n\nif (upd.message) {\n  const m = upd.message;\n  return [{\n    json: {\n      is_callback: false,\n      update_type: 'message',\n      text: m.text || '',\n      voice: m.voice ? m.voice.file_id : null,\n      chat_id: m.chat.id,\n      user_id: m.from?.id ?? null,\n      user_name: [m.from?.first_name, m.from?.last_name].filter(Boolean).join(' ') || m.from?.username || null,\n      update_id: upd.update_id\n    }\n  }];\n}\n\nreturn [];\n"
      },
      "name": "Get Last Message",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -2384,
        640
      ],
      "id": "af535c1d-a59d-42f9-9b83-14d6fce7f66a"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/home/adminvm/n8n_data/tg_id",
        "dataPropertyName": "=data",
        "options": {
          "append": "={{ $json.update_id }}"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -1680,
        -448
      ],
      "id": "29fa7e18-533a-4a92-85e0-8d2f51a33127",
      "name": "Read/Write Files from Disk"
    },
    {
      "parameters": {
        "jsCode": "const updateId = $items(\"Get Last Message\")[0].json.update_id;\n\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º update_id –≤ JSON –∏ –∑–∞—Ç–µ–º –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\nconst data = JSON.stringify({ last_processed_update_id: updateId });\nconsole.log('Preparing data for file:', data);\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: Buffer.from(data).toString('base64'),\n      mimeType: 'application/json'\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1856,
        -320
      ],
      "id": "8c95b79d-33b9-4031-804c-7af6e7bb1a84",
      "name": "Code"
    },
    {
      "parameters": {
        "fileSelector": "/home/adminvm/n8n_data/tg_id",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -2976,
        640
      ],
      "id": "919b371d-838b-482d-9507-e9618ca8a049",
      "name": "Read/Write Files from Disk2"
    },
    {
      "parameters": {
        "jsCode": "try {\n  // –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64-–¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–ª—è\n  const binaryData = items[0].binary.data.data;\n  const decodedData = Buffer.from(binaryData, 'base64').toString('utf8');\n  \n  // –ü–∞—Ä—Å–∏–º JSON\n  const data = JSON.parse(decodedData);\n  \n  // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n  console.log('Parsed data:', data);\n  \n  return [{ json: { last_processed_update_id: data.last_processed_update_id || 0 } }];\n} catch (e) {\n  console.log('Error parsing update ID file:', e.message);\n  return [{ json: { last_processed_update_id: 0 } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2784,
        640
      ],
      "id": "f5d73113-78ce-4773-adfe-e689868e0926",
      "name": "Parse Update ID"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "seconds",
              "secondsInterval": 5
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -3168,
        640
      ],
      "id": "ad9316f3-204a-4cb2-9879-51eb35ee5489",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Get Last Message').item.json.is_callback }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "7ad4d126-53d6-4db4-8484-e723d8925525"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "callback"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "62ec01ec-ff8d-4a52-ab47-f61f653d73a5",
                    "leftValue": "={{ $('Get Last Message').item.json.voice }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "04392c2d-95f5-46fe-ae98-265082003e53",
                    "leftValue": "={{ $('Get Last Message').item.json.text }}",
                    "rightValue": true,
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1888,
        464
      ],
      "id": "b2392f35-1596-49f4-8b5a-6de5af81b538",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    file_path: $json[\"result\"][\"file_path\"]\n  }\n}];"
      },
      "name": "Extract File Path1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1328,
        32
      ],
      "id": "20eecf01-7bc7-4ba4-ad4d-882750c73f11"
    },
    {
      "parameters": {
        "url": "={{\"http://84.19.3.244/tg/file/bot8307440026:AAHlFCU6CCar7-xA3nGvhN1CQH9Lh-3N3UQ/\" + $json[\"file_path\"]}}",
        "responseFormat": "file",
        "options": {}
      },
      "name": "Download Voice1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        -1168,
        32
      ],
      "id": "d774df0c-db5f-4406-98f9-1a9e4a6e57be"
    },
    {
      "parameters": {
        "url": "=http://84.19.3.244/tg/bot8307440026:AAHlFCU6CCar7-xA3nGvhN1CQH9Lh-3N3UQ/getFile?file_id={{ $('Get Updates').item.json.result[0].message.voice.file_id }}",
        "options": {}
      },
      "name": "Get Updates1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        -1472,
        32
      ],
      "id": "f7ad450e-912d-4fde-9cee-5f355e788bf1"
    },
    {
      "parameters": {
        "command": "=echo '{{ JSON.stringify($json) }}' | /home/adminvm/venv/bin/python3 /home/adminvm/scripts/generate_chart.py\n"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -80,
        -384
      ],
      "id": "9e4d62cd-bda9-474f-854d-115b5a4d8646",
      "name": "Execute Command"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('Get Updates').item.json.result[0].message.chat.id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        544,
        -384
      ],
      "id": "ba1782db-e63a-4002-9139-c0a1c209090c",
      "name": "Telegram2",
      "webhookId": "26cea149-fec1-48bb-b1e1-4c487fa7d77b",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "fileSelector": "/home/adminvm/scripts/chart.png",
        "options": {
          "dataPropertyName": "data"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        256,
        -384
      ],
      "id": "30b5235d-fe35-4374-bef1-74bb348dea28",
      "name": "Read/Write Files from Disk3"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Code6 ‚Äî Telegram-safe HTML + –ø–æ–¥–¥–µ—Ä–∂–∫–∞ <pre><code>...</code></pre>\n */\n\nfunction escapeHTML(s) {\n  return s.replace(/&/g, '&amp;')\n          .replace(/</g, '&lt;')\n          .replace(/>/g, '&gt;')\n          .replace(/\"/g, '&quot;')\n          .replace(/'/g, '&#039;');\n}\n\nconst ALLOWED_TAGS = new Set([\n  'b', 'strong', 'i', 'em', 'u', 'ins', 's', 'strike', 'del',\n  'code', 'pre', 'a', 'span'\n]);\nconst ALLOWED_ATTR = {\n  a: ['href'],\n  span: ['class']\n};\n\n// –°–æ—Ö—Ä–∞–Ω—è–µ–º <pre><code>...</code></pre> –±–ª–æ–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ\nconst preBlocks = [];\n\nfor (const item of $input.all()) {\n  let html = (item.json.output ?? '').trim();\n\n  if (!html) {\n    item.json.html = '‚ö†Ô∏è –ù–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –∞–≥–µ–Ω—Ç–∞.';\n    continue;\n  }\n\n  // 1Ô∏è‚É£ –í—ã—Ä–µ–∑–∞–µ–º <pre><code>...</code></pre> –∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ\n  html = html.replace(/<pre>\\s*<code>([\\s\\S]*?)<\\/code>\\s*<\\/pre>/gi, (_, code) => {\n    const idx = preBlocks.length;\n    preBlocks.push(`<pre><code>${escapeHTML(code)}</code></pre>`);\n    return `__PRE_BLOCK_${idx}__`;\n  });\n\n  // 2Ô∏è‚É£ –ü–µ—Ä–µ–Ω–æ—Å—ã: <br>, <p> ‚Üí \\n\n  html = html.replace(/<\\s*br\\s*\\/?>/gi, '\\n')\n             .replace(/<\\s*\\/?\\s*p[^>]*>/gi, '\\n');\n\n  // 3Ô∏è‚É£ –°–ø–∏—Å–∫–∏: <li> ‚Üí ‚Ä¢ ‚Ä¶\\n, –∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–¥–∞–ª–∏—Ç—å\n  html = html.replace(/<li[^>]*>/gi, '‚Ä¢ ')\n             .replace(/<\\/li>/gi, '\\n')\n             .replace(/<\\/?(ul|ol|div|table)[^>]*>/gi, '');\n\n  // 4Ô∏è‚É£ –£–¥–∞–ª—è–µ–º –Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ç–µ–≥–∏\n  html = html.replace(/<\\/?([a-zA-Z][\\w\\-]*)\\b([^>]*)>/g, (m, tag, attrs) => {\n    tag = tag.toLowerCase();\n    if (!ALLOWED_TAGS.has(tag)) return '';\n\n    if (ALLOWED_ATTR[tag]) {\n      const keep = ALLOWED_ATTR[tag];\n      attrs = attrs.replace(/\\s+([\\w\\-:]+)(=\"[^\"]*\")?/g,\n        (_, name, val) => keep.includes(name.toLowerCase()) ? ` ${name}${val || ''}` : '');\n    } else {\n      attrs = '';\n    }\n\n    if (tag === 'span' && !/class\\s*=\\s*\"tg-spoiler\"/i.test(attrs)) return '';\n    return `<${m.startsWith('</') ? '/' : ''}${tag}${attrs}>`;\n  });\n\n  // 5Ô∏è‚É£ –í–µ—Ä–Ω—ë–º <pre><code>...</code></pre> –æ–±—Ä–∞—Ç–Ω–æ\n  html = html.replace(/__PRE_BLOCK_(\\d+)__/g, (_, n) => preBlocks[n] || '');\n\n// 6Ô∏è‚É£ –£–¥–∞–ª—è–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º ‚ÇΩ –∏ –≤–∞–ª—é—Ç–Ω—ã–µ –∑–Ω–∞–∫–∏\nhtml = html.replace(/[^\\x09\\x0A\\x0D\\x20-\\x7E–∞-—è–ê-–Ø—ë–Å0-9‚ÇΩ¬•‚Ç¨$¬£.,:;'\"!?<>\\s\\-‚Äì‚Äî=_()\\[\\]{}|\\\\/@#$%^&*~`+]/g, '');\n\n\n  // 7Ô∏è‚É£ –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ \\n\n  html = html.replace(/\\n{3,}/g, '\\n\\n').trim();\n\n  if (!html) html = '‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';\n  item.json.html = html;\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -304,
        240
      ],
      "id": "36e59431-15a0-4044-bfbe-453ff9f58d50",
      "name": "Code6"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "let raw = $json.output ?? \"\";\n\nif (typeof raw === \"object\") {\n\treturn { json: raw };\n}\n\nif (typeof raw === \"string\") {\n\traw = raw.trim();\n\tif (raw.startsWith('\"') && raw.endsWith('\"')) {\n\t\traw = raw.slice(1, -1)\n\t\t         .replace(/\\\\n/g, \"\\n\")\n\t\t         .replace(/\\\\\"/g, '\"');\n\t}\n\n\ttry {\n\t\tconst parsed = JSON.parse(raw);\n\t\treturn { json: parsed };\n\t} catch {}\n}\n\nreturn { json: { output: raw, direct_chart: false, chart: null } };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -768,
        320
      ],
      "id": "77acdc32-f718-4ffb-92ca-dc349dce9486",
      "name": "Parse Chart Data2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.direct_chart }}",
                    "rightValue": "true",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "d30cf634-21eb-4260-b6b7-07935827945d"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2ccb3b8b-36b3-49e0-a046-f2154b3b4230",
                    "leftValue": "={{$json.send_excel}}",
                    "rightValue": "true",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0b82796d-a0c8-4799-b14f-9a59f17323c7",
                    "leftValue": "={{ $json.send_card }}",
                    "rightValue": "true",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "643ab08f-8fea-4e35-ad6a-37ba18e6a094",
                    "leftValue": "={{$json.callback_query.data}}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -528,
        0
      ],
      "id": "77bd1788-e863-49fd-9723-e6b41426b4aa",
      "name": "Switch1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "chat_id"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -1296,
        592
      ],
      "id": "99e4c854-fedd-4e68-835a-2cfd54826323",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "ow6dH5LI0bWpG5Xc",
          "name": "Redis account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ë–µ—Ä—ë–º –≤–µ—Å—å chart-–∫–æ–Ω—Ñ–∏–≥ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–ª—å—à–µ\nreturn [{\n  json: $json.chart\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -304,
        -384
      ],
      "id": "72e53f24-6734-4e65-9147-db5192102363",
      "name": "Chart Builder"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Get all the data from Postgres, make sure you append the tables with correct schema. Every table is associated with some schema in the database.",
        "operation": "executeQuery",
        "query": "{{ $fromAI(\"sql_query\", \"SQL Query\") }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -896,
        592
      ],
      "id": "a4498901-92a3-4e33-8677-fb8a3d576d78",
      "name": "Execute a SQL query in Postgres",
      "credentials": {
        "postgres": {
          "id": "rwMxCroQkG7g1tMx",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('Get Updates').item.json.result[0].message.chat.id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        544,
        48
      ],
      "id": "afa1b6fe-2e88-4d6c-b23d-3ea4e373c77e",
      "name": "Send a document",
      "webhookId": "c6720f13-8ba7-4178-8e91-16ce745d45ac",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/**\n * Code4 ‚Äì –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π —Ñ–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å\n *\n *  ‚ñ∏ –µ—Å–ª–∏ rep_name === \"all\" ‚Äì –±–µ—Ä—ë–º –∞—Ä—Ö–∏–≤ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫\n *  ‚ñ∏ –∏–Ω–∞—á–µ ‚Äì –æ–¥–Ω—É html-–∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ\n */\n\nconst rep   = $json.rep_name || '';\nconst isAll = rep.trim().toLowerCase() === 'all';\n\nreturn [{\n  json: {\n    rep_name: rep,\n    // –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∞—è –Ω–æ–¥–∞\n    file_path: isAll\n      ? '/home/adminvm/cards/card_*.html'                        // –∞—Ä—Ö–∏–≤\n      : `/home/adminvm/cards/card_${rep.replace(/ /g, '_')}.html`  // –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -304,
        48
      ],
      "id": "efe794d4-8db6-4518-8336-621b09d65b58",
      "name": "Code4"
    },
    {
      "parameters": {
        "chatId": "={{ $('Get Updates').item.json.result[0].message.chat.id }}",
        "text": "={{ $('Code6').item.json.html }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ",
                    "additionalFields": {
                      "callback_data": "=train:{{ $json.log_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        544,
        256
      ],
      "id": "d9414711-2d39-43ed-8e1b-87b6341c007d",
      "name": "Send a text message",
      "webhookId": "0c834359-b1c7-4b27-ae26-2106eb13a9d6",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "fileSelector": "={{ $json.file_path }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        128,
        48
      ],
      "id": "ec56e89c-15c2-40fd-ad1c-1386fd9ec0f5",
      "name": "Read/Write Filesfrom  Disk5"
    },
    {
      "parameters": {
        "jsCode": "const isCb = $json.is_callback ?? false;\n\nreturn [{\n  json: {\n    chat_id:        $json.chat_id,\n    user_id:        isCb ? $json.clicked_by : $json.user_id,\n    user_name:      $json.user_name || null,\n    user_request:   isCb ? $json.data : $json.text || null,\n    agent_response: isCb ? null : ($json.html || null),\n    n8n_execution:  $execution.id\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        240
      ],
      "id": "e74aa6e3-ad7c-4c59-929b-f51c8c7f58fa",
      "name": "Prepare Log"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.agent_logs (\n  chat_id,\n  user_id,\n  user_name,\n  user_request,\n  agent_response,\n  n8n_execution\n)\nVALUES (\n  {{ $json.chat_id }},\n  {{ $json.user_id }},\n  {{ $json.user_name ? `'${$json.user_name.replace(/'/g,\"''\")}'` : 'NULL' }},\n  {{ $json.user_request ? `'${$json.user_request.replace(/'/g,\"''\")}'` : 'NULL' }},\n  {{ $json.agent_response ? `'${$json.agent_response.replace(/'/g,\"''\")}'` : 'NULL' }},\n  {{ $json.n8n_execution ? `'${$json.n8n_execution.replace(/'/g,\"''\")}'` : 'NULL' }}\n)\nRETURNING id AS log_id;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        208,
        416
      ],
      "id": "1a7e8438-0ca1-4c50-a580-7c84a176bc86",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "rwMxCroQkG7g1tMx",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -160,
        656
      ],
      "id": "25924fb2-3e95-4678-9c12-c5f6aaa997f6",
      "name": "Merge"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.training_clicks (log_id, chat_id, clicked_by, status)\nVALUES (\n  {{ $('Get Last Message').item.json.log_id }},\n  {{ $('Get Last Message').item.json.chat_id }},\n  {{ $('Get Last Message').item.json.clicked_by }},\n  '–≤ –æ—á–µ—Ä–µ–¥–∏'\n)\nRETURNING id;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1520,
        -144
      ],
      "id": "99a8c75d-50d2-4790-ba0f-cad07a7d671c",
      "name": "Execute a SQL query1",
      "credentials": {
        "postgres": {
          "id": "rwMxCroQkG7g1tMx",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Get Last Message').item.json.chat_id }}",
        "text": "–í–∞—à –∑–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç –≤ —Ä–∞–±–æ—Ç—É, –æ–∂–∏–¥–∞–π—Ç–µ",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1872,
        -496
      ],
      "id": "257a269a-12c8-4bf7-b602-d35ea55a8d33",
      "name": "Send a text message2",
      "webhookId": "23519533-f8e9-42ea-8e67-26b940da6bfc",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        384,
        256
      ],
      "id": "762eb050-cf86-4c10-bcb3-403053235c68",
      "name": "Merge1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Get Last Message').item.json.chat_id }}",
        "text": "–°–¥–µ–ª–∞–Ω–æ!",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1024,
        -448
      ],
      "id": "d3cf2f00-7dc5-4487-bed0-8e4e6f2decdb",
      "name": "Send a text message3",
      "webhookId": "efb2320b-b32d-415b-ba42-72c41f46696b",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "ZnhDE5fEX25JEZUO",
          "mode": "list",
          "cachedResultName": "Mail Packager & Send"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "recipient": "={{$json.recipient || $json.query.recipient}}",
            "subject": "={{ $json.subject }}",
            "body": "={{ $json.body }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "recipient",
              "displayName": "recipient",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "subject",
              "displayName": "subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "attachments",
              "displayName": "attachments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": true,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        -880,
        816
      ],
      "id": "993db747-dd46-4b24-97f7-047e01db392c",
      "name": "Execute Workflow"
    },
    {
      "parameters": {
        "jsCode": "// –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —á–∏—Å—Ç—ã–π –ø–∞–π–ø –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π\nconst trig = $item(0, 'When Executed by Another Workflow')?.json ?? {};\nconst rq   = trig.query ?? {};\n\nconst recipient = $json.recipient ?? trig.recipient ?? rq.recipient ?? null;\nconst subject   = $json.subject   ?? trig.subject   ?? rq.subject   ?? '–ë–µ–∑ —Ç–µ–º—ã';\nconst body      = $json.body      ?? trig.body      ?? rq.body      ?? '';\n\nif (!recipient) throw new Error('recipient –ø—É—Å—Ç –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º WF');\n\n// –ù–ò–ß–ï–ì–û –ø—Ä–æ attachments –∏ binary –Ω–µ –ø–µ—Ä–µ–¥–∞—ë–º\nreturn [{ json: { recipient, subject, body } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1024,
        816
      ],
      "id": "ae1dab3f-d655-4155-8d77-89f5433570ad",
      "name": "Code1"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "recipient"
            },
            {
              "name": "subject"
            },
            {
              "name": "body"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1312,
        816
      ],
      "id": "e382e80a-4b41-4a41-be48-bfdf826a0a77",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "jsCode": "const q = $json.query || {};\nreturn [{\n  json: {\n    recipient: q.recipient ?? $json.recipient ?? null,\n    subject:   q.subject   ?? $json.subject   ?? '–ë–µ–∑ —Ç–µ–º—ã',\n    body:      q.body      ?? $json.body      ?? '',\n    attachments: Array.isArray(q.attachments ?? $json.attachments)\n      ? (q.attachments ?? $json.attachments) : [],\n  },\n  binary: $binary,\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1168,
        816
      ],
      "id": "7019ff4b-6464-4d52-b070-11747596acc0",
      "name": "Code7"
    },
    {
      "parameters": {
        "command": "=echo '{{ $json.jsonText }}' > /tmp/input.txt && \\\n/home/adminvm/venv/bin/python /home/adminvm/scripts/generate_excel.py --json-out < /tmp/input.txt\n"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -144,
        -176
      ],
      "id": "42ccd7f8-b358-4002-a558-05280b20346b",
      "name": "generate_excel"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Code3 ‚Äì –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel\n * –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –ø–æ–ª—è, —á—Ç–æ–±—ã subject –Ω–µ –ø–æ—Ç–µ—Ä—è–ª—Å—è\n */\nreturn $input.all().map(item => {\n  const table   = item.json.table_data || [];\n  const subject = item.json.subject    || 'Excel-–æ—Ç—á—ë—Ç';\n\n  return {\n    json: {\n      ...item.json,                 // ‚¨ÖÔ∏è   —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—ë, —á—Ç–æ –ø—Ä–∏—à–ª–æ\n      jsonText: JSON.stringify(table),\n      subject,                      // –¥—É–±–ª–∏—Ä—É–µ–º, –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π\n    }\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -304,
        -176
      ],
      "id": "d5e2ea23-0006-40d8-a87f-fd68dc6926b7",
      "name": "Code3"
    },
    {
      "parameters": {
        "fileSelector": "/home/adminvm/scripts/report.xlsx",
        "options": {
          "dataPropertyName": "data"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        0,
        -176
      ],
      "id": "9f636349-d9dc-44ef-b480-e64b1ff57518",
      "name": "Read/Write Files from Disk1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Get Updates').item.json.result[0].message.chat.id }}",
        "text": "–û—Ç–ø—Ä–∞–≤–∏–ª",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        544,
        -176
      ],
      "id": "a1e6f189-24fc-47d4-bb62-d0f3f41181e2",
      "name": "Send a text message1",
      "webhookId": "0babe63a-c35f-4ed6-94c1-a54f1e990178",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –í—Ö–æ–¥: { stdout: \"<BASE64>\", exitCode: 0 }\n// –í—ã—Ö–æ–¥: json —Å –ø–æ–ª—è–º–∏ –ø–∏—Å—å–º–∞ + binary.data c Excel\n\n// 1) base64 –∏–∑ stdout\nconst b64 = String($json.stdout || '').trim();\nif (!b64) throw new Error('stdout –ø—É—Å—Ç: –Ω–µ—Ç base64 Excel');\n\n// 2) –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –ø–æ–ª—è –ø–∏—Å—å–º–∞ –∏–∑ —É–∑–ª–∞, –≥–¥–µ –æ–Ω–∏ –ª–µ–∂–∞—Ç (–∑–∞–º–µ–Ω–∏ –∏–º—è —É–∑–ª–∞ –Ω–∞ —Å–≤–æ—ë)\nconst src = $('Parse Chart Data2').first().json || {}; // <- —Ç–≤–æ–π —É–∑–µ–ª —Å subject/body/recipient\n\n// 3) —Ñ–æ—Ä–º–∏—Ä—É–µ–º item –¥–ª—è –ø–æ–¥–≤–æ—Ä–∫—Ñ–ª–æ—É SendMailWorkflow\nreturn [{\n  json: {\n    recipient: String(src.recipient || '').trim(),\n    subject:   String(src.subject   || '–ë–µ–∑ —Ç–µ–º—ã'),\n    body:      String(src.body      || ''),\n    attachments: ['data']                 // —Å–∫–∞–∂–µ–º —Å–∞–±-–≤–æ—Ä–∫—Ñ–ª–æ—É –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å binary \"data\"\n  },\n  binary: {\n    data: {\n      data: b64,                           // <-- —Å–∞–º —Ñ–∞–π–ª (base64)\n      fileName: 'report.xlsx',\n      mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        288,
        -176
      ],
      "id": "0feecadd-2e6c-4ce7-af18-f024b8d61f34",
      "name": "Code2"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "ZnhDE5fEX25JEZUO",
          "mode": "list",
          "cachedResultName": "Mail Packager & Send"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "recipient",
              "displayName": "recipient",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "subject",
              "displayName": "subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "attachments",
              "displayName": "attachments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        416,
        -176
      ],
      "id": "18dc96bd-7331-4a79-8300-87c564b945be",
      "name": "Execute Workflow1"
    },
    {
      "parameters": {
        "command": "base64 -w 0 /home/adminvm/scripts/report.xlsx\n"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        144,
        -176
      ],
      "id": "a57c6eab-89b1-40bf-8755-83496ce1ea89",
      "name": "Execute Command1"
    },
    {
      "parameters": {
        "description": "Send email with optional attachments.\nInputs (JSON):\n- recipient: string (email or contact name/alias)\n- subject: string (default: \"–ë–µ–∑ —Ç–µ–º—ã\")\n- body: string (email HTML/text)\n- attachments?: array<string> ‚Äî names of binary props; if not provided, do NOT send this field. The workflow will generate note.txt from body.\nReturn: status and messageId.\nNever pass \"none\" for attachments.\n",
        "workflowId": {
          "__rl": true,
          "value": "Zy5T19Qy9MXp5t1v",
          "mode": "list",
          "cachedResultName": "For_Muslim"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "recipient": "={{ $fromAI('recipient', ``, 'string') }}",
            "subject": "={{ $fromAI('subject', ``, 'string') }}",
            "body": "={{ $fromAI('body', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "recipient",
              "displayName": "recipient",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "subject",
              "displayName": "subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -1184,
        592
      ],
      "id": "736b43c6-34c9-4069-9cd2-048da35d3a21",
      "name": "SendMailWorkflow"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Send a text message2').item.json.result.chat.id }}",
        "messageId": "={{ $('Send a text message2').item.json.result.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        976,
        -64
      ],
      "id": "a92c30aa-c951-4e8c-b833-e5a579c9bb7a",
      "name": "Delete a chat message3",
      "webhookId": "eaa669a2-0b08-449d-a9b8-f30abfad2b19",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        816,
        -464
      ],
      "id": "2417dd69-9178-4246-b41a-2286343ff19a",
      "name": "Merge2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT EXISTS(\n  SELECT 1 FROM bot_autorized_chats WHERE chat_id = $1\n) AS allowed;\n",
        "options": {
          "queryReplacement": "={{ $json.chat_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2256,
        400
      ],
      "id": "15f260ee-13ee-4b51-a313-a292eb242fb5",
      "name": "Execute a SQL query2",
      "credentials": {
        "postgres": {
          "id": "rwMxCroQkG7g1tMx",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.allowed }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "1548867d-fd58-4df4-a461-c1a894c9d633"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–î–æ—Å—Ç—É–ø –µ—Å—Ç—å"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "69f03a16-13f2-4fc4-b927-92aa470e7b89",
                    "leftValue": "={{ $json.allowed }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–î–æ—Å—Ç—É–ø–∞ –Ω–µ—Ç"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2112,
        16
      ],
      "id": "7b807b88-68ae-458c-b210-b16b5c0ca4d6",
      "name": "Switch2"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/home/adminvm/n8n_data/tg_id",
        "dataPropertyName": "=data",
        "options": {
          "append": "={{ $json.update_id }}"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -1664,
        -256
      ],
      "id": "c98bd494-3dc9-4935-a568-d800d40b84fa",
      "name": "Read/Write Files from Disk4"
    },
    {
      "parameters": {
        "jsCode": "const updateId = $items(\"Get Last Message\")[0].json.update_id;\n\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º update_id –≤ JSON –∏ –∑–∞—Ç–µ–º –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\nconst data = JSON.stringify({ last_processed_update_id: updateId });\nconsole.log('Preparing data for file:', data);\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: Buffer.from(data).toString('base64'),\n      mimeType: 'application/json'\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1840,
        -80
      ],
      "id": "2b528f90-9a50-4f9b-b34a-d4b229e6bcb5",
      "name": "Code5"
    },
    {
      "parameters": {
        "chatId": "={{ $('Get Last Message').item.json.chat_id }}",
        "text": "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1408,
        -448
      ],
      "id": "7d2f6a77-4584-4f5c-8286-dff0e9a98141",
      "name": "Send a text message4",
      "webhookId": "d4b36267-6e4d-4533-b4c9-be78a88acadf",
      "credentials": {
        "telegramApi": {
          "id": "LK8mWaz3RxYafXEV",
          "name": "Telegram account 5"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "ru"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -1024,
        32
      ],
      "id": "b1bb20f6-b845-482f-bbb7-b0401a89abc2",
      "name": "Transcribe a recording",
      "credentials": {
        "openAiApi": {
          "id": "Qc85KFzgvCeEqnB7",
          "name": "OpenAi account 3"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse Chart Data2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Updates": {
      "main": [
        [
          {
            "node": "Get Last Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Last Message": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          },
          {
            "node": "Execute a SQL query2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk2": {
      "main": [
        [
          {
            "node": "Parse Update ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Update ID": {
      "main": [
        [
          {
            "node": "Get Updates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Execute a SQL query1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Updates1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract File Path1": {
      "main": [
        [
          {
            "node": "Download Voice1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Voice1": {
      "main": [
        [
          {
            "node": "Transcribe a recording",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Updates1": {
      "main": [
        [
          {
            "node": "Extract File Path1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk3": {
      "main": [
        [
          {
            "node": "Telegram2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Chart Data2": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Chart Builder",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Chart Builder": {
      "main": [
        [
          {
            "node": "Execute Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query in Postgres": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Read/Write Filesfrom  Disk5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Read/Write Filesfrom  Disk5": {
      "main": [
        [
          {
            "node": "Send a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Log": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Prepare Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query1": {
      "main": [
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Execute Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate_excel": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "generate_excel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk1": {
      "main": [
        [
          {
            "node": "Execute Command1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Execute Workflow1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow1": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command1": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SendMailWorkflow": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message2": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram2": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Send a text message1": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Send a document": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Delete a chat message3": {
      "main": [
        []
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Delete a chat message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message3": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Execute a SQL query2": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk4": {
      "main": [
        [
          {
            "node": "Send a text message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8a3ca006-96ba-4fba-a629-3a27fc01d23a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "14d29bd49266811c3d746addfedf829ab5a522313a58bcf72777d5e72c76d232"
  },
  "id": "VL0ysfTmWyWfcLGZ",
  "tags": []
}